<div class="row d-flex justify-content-center mt-5">
    <div class="wrapper col col-lg-12 col-md-12 col-sm-12 mb-4">
        <h1 class="writer-publish-news-title">Hiệu chỉnh bài viết</h1>
    </div>
    <form action="" method="POST" class="writer-publish-news-container col col-lg-12 col-md-12 col-sm-12"
        enctype="multipart/form-data">
        <input type="text" style="display: none;" name="id" value="{{data.ID}}">
        </input>
        <div class="mb-4">
            <label for="title" class="form-label input-title">Nhập tiêu đề</label>
            <input type="text" class="form-control input-field" id="title" name="title" value="{{data.Title}}" />
        </div>
        <div class="mb-4">
            <label for="abstract" class="form-label input-title">Nhập tóm tắt nội dung</label>
            <textarea class="form-control textarea-field" id="abstract" rows="10"
                name="abstract">{{data.Abstract}}</textarea>
        </div>
        <div class="mb-4">
            <label for="backgroundImageArticle" class="form-label input-title">Ảnh đại diện bài viết</label>
            <input type="file" class="form-control textarea-field" id="backgroundImageArticle" rows="10"
                name="backgroundImage" />
            <input type="text" style="display: none;" id="backgroundImageArticleBase64" name="backgroundImageArticle">
            </input>
        </div>
        <div class="mb-4">
            <p class="input-title">Nhập nội dung</p>
            <textarea id="summernote" name="content">{{{data.Content}}}</textarea>
        </div>
        <div class="mb-4">
            <label class="form-label input-title">Chọn chuyên mục</label>
            <div class="form-label" id="selectedCategory">Bạn đã chọn: </div>
            <div class="tree">
                <ul>
                    <li onclick="toggleNode(event)"> Chọn chuyên mục
                        <ul>
                            {{#each Categories}}
                            <li onclick="toggleNode(event)">
                                <label class="form-label">{{name}}</label>
                                <ul>
                                    {{#each SubCategories}}
                                    <li class="leaf">
                                        <label class="form-label" for="subcategory_{{id}}">{{name}}</label>
                                        <input type="radio" data-category-fullname="{{fullname}}" name="category"
                                            value="{{id}}" id="subcategory_{{id}}" {{#if (eq ../../data.selectedCategory
                                            id)}} checked {{/if}}>
                                    </li>
                                    {{/each}}
                                </ul>
                            </li>
                            {{/each}}
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
        <div class="mb-4">
            <label for="tag" class="form-label input-title">Nhập Tags</label>
            <input type="text" class="form-control input-field" id="tag" name="tag" />
        </div>
        <div class="mb-4 w-100 d-flex align-center justify-content-between">
            <p class="input-title">Bài báo Premium</p>
            <label class="switch">
                <input type="checkbox" name="isPremium" {{#if (eq data.IsPremium 1)}} checked{{/if}} />
                <span class="slider round"></span>
            </label>
        </div>
        <div class="writer-publish-news-footer d-flex justify-content-end w-100">
            <button type="submit" formaction="" class="back-button">
                Quay về
            </button>
            <button type="submit" formaction="/writer/edit" class="submit-button">
                Đăng
            </button>
        </div>
    </form>
</div>
{{#section 'script'}}
<script>
    function toggleNode(event) {
        event.stopPropagation();
        const li = event.target.closest('li');
        if (li.classList.contains('leaf')) {
            return;
        }
        li.classList.toggle('expanded');
    }
    document.addEventListener('DOMContentLoaded', () => {
        const radioButtons = document.querySelectorAll('.leaf input[type="radio"]');

        radioButtons.forEach(radio => {
            radio.addEventListener('change', function () {
                if (this.checked) {
                    onRadioSelect(this.getAttribute("data-category-fullname"));
                }
            });
        });
    });

    function onRadioSelect(value) {
        document.getElementById("selectedCategory").innerHTML = "Bạn đã chọn: " + value;
    }
    document.getElementById("selectedCategory").innerHTML = "Bạn đã chọn: {{data.selectedCategoryName}}";

</script>
{{#if (neq data.BackgroundImage 'null')}}
<script>
    $("#backgroundImageArticle").fileinput({
        maxFileCount: 1,
        showUpload: false,
        previewFileType: 'image',
        allowedFileTypes: ['image'],
        initialPreviewAsData: true,
        initialPreview: [
            "{{ data.BackgroundImage }}"
        ],
        initialPreviewConfig: [
            { url: "{{ data.BackgroundImage }}", key: 1 }
        ],
        showPreview: true,
    });

    $(".kv-file-remove").hide();

    $("#backgroundImageArticle").on("fileloaded", function (event, file) {
        var reader = new FileReader();

        reader.onload = function (e) {
            $("#backgroundImageArticleBase64").val(e.target.result);
        };

        reader.readAsDataURL(file);
    });

    $("#backgroundImageArticleBase64").val("not changed");

    // Optional: Reset the hidden input when the file input is cleared
    $("#backgroundImageArticle").on("fileclear", function () {
        $("#backgroundImageArticleBase64").val("");
    });
</script>
{{else}}
<script>
    $("#backgroundImageArticle").fileinput({
        maxFileCount: 1,
        showUpload: false,
        previewFileType: 'image',
        allowedFileTypes: ['image'],
    });

    $("#backgroundImageArticle").on("fileloaded", function (event, file) {
        var reader = new FileReader();

        reader.onload = function (e) {
            $("#backgroundImageArticleBase64").val(e.target.result);
        };

        reader.readAsDataURL(file);
    });

    // Optional: Reset the hidden input when the file input is cleared
    $("#backgroundImageArticle").on("fileclear", function () {
        $("#backgroundImageArticleBase64").val("");
    });
</script>
{{/if}}
{{/section}}